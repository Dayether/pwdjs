RewriteEngine On
RewriteBase /pwdjs/public/

# 1. Canonical redirect: any direct *.php request -> extensionless
#    Works even if user manually types the .php filename.
RewriteCond %{THE_REQUEST} \s/+[^\s]*?(.+?)\.php[\s?] [NC]
RewriteRule ^(.+?)\.php$ /pwdjs/public/$1 [R=301,L,NE]

# 2. Block path-info after .php (e.g., file.php/extra) by redirecting to clean
RewriteCond %{THE_REQUEST} \s/+[^\s]*?(.+?)\.php/ [NC]
RewriteRule ^(.+?)\.php/ /pwdjs/public/$1 [R=301,L,NE]

# 3. Allow direct access to static assets / uploads before other rewrites
RewriteRule ^(assets/|uploads/|PHPMailer/|favicon\.ico) - [L]

# 4. Short-circuit for existing files/dirs (except we already handled direct .php above)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d [OR]
RewriteCond %{REQUEST_FILENAME} -l
RewriteRule ^ - [L]

# 5. Internal rewrite: extensionless -> corresponding .php if it exists
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/pwdjs/public/$1.php -f
RewriteRule ^([^/]+)/?$ $1.php [L,QSA]

# 6. Security: disallow direct web access to migrations directory
RewriteRule ^config/migrations/ - [F]

# 7. Optional custom 404 handler (uncomment and create file if desired)
# ErrorDocument 404 /pwdjs/public/404
